

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

     <title>Lab 2</title> 
    <meta name="description" content="Morse Code with Timers">
    <meta name="author" content="Caleb Kemere">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="/2023/assets/themes/bootstrap/resources/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/2023/assets/themes/bootstrap/elec327.css" rel="stylesheet">
  
    <!--[if lt IE 9]>
      <script src="/assets/themes/bootstrap/resources/respond/Respond.min.js"></script>
    <![endif]-->

    <link href="/2023/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/2023/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>

        <nav class="navbar navbar-expand-lg navbar-dark bg-primary" role="navigation">
        <div class="container">
        <a class="navbar-brand" href="/2023/">Rice ELEC327 - Digital Systems Laboratory</a>

      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="navbar-collapse collapse" id="navbarSupportedContent">
          <ul class="navbar-nav navbar-dark mr-auto">
            
            
            


  
    
      
      	
      	<li class="nav-item"><a class="dropdown-item nav-link" href="/2023/bonus">Bonus</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li class="nav-item"><a class="dropdown-item nav-link" href="/2023/">Home</a></li>
      	
      
    
  
    
      
      	
      	<li class="nav-item"><a class="dropdown-item nav-link" href="/2023/parts_and_notes">Parts/Notes</a></li>
      	
      
    
  
    
      
      	
      	<li class="nav-item"><a class="dropdown-item nav-link" href="/2023/syllabus">Syllabus</a></li>
      	
      
    
  




            <li class="nav-item dropdown">
              <a href="#" class="nav-link dropdown-toggle" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Labs</a>
              <ul class="dropdown-menu bg-primary" aria-labelledby="navbarDropdown"role="menu">
                
                
                


  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li class="nav-item"><a class="dropdown-item nav-link" href="/2023/lab1/">Lab 1</a></li>
      	
      
    
  
    
      
      	
      	<li class="nav-item active"><a href="/2023/lab2/" class="dropdown-item active nav-link">Lab 2</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li class="nav-item"><a class="dropdown-item nav-link" href="/2023/lab3/">Lab 3</a></li>
      	
      
    
  
    
      
      	
      	<li class="nav-item"><a class="dropdown-item nav-link" href="/2023/lab4/">Lab 4</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li class="nav-item"><a class="dropdown-item nav-link" href="/2023/lab5/">Lab 5</a></li>
      	
      
    
  
    
      
      	
      	<li class="nav-item"><a class="dropdown-item nav-link" href="/2023/lab6/">Lab 6</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li class="nav-item"><a class="dropdown-item nav-link" href="/2023/lab7/">Lab 7</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li class="nav-item"><a class="dropdown-item nav-link" href="/2023/midterm_project/">Midterm Project</a></li>
      	
      
    
  
    
      
      	
      	<li class="nav-item"><a class="dropdown-item nav-link" href="/2023/final_project/">Final Project</a></li>
      	
      
    
  




              </ul>
            </li>
          </ul>
      </div>
      </div>
    </nav>



    <div class="container under-navbar">
      
<h3 id="lab-2-morse-code-with-timers-on-the-msp430-100-pts">Lab #2: Morse Code with Timers on the MSP430 (100 pts)</h3>

<div class="alert alert-info" role="alert">
  <h4 id="there-are-three-goals-for-this-assignment"><strong>There are three goals for this assignment:</strong></h4>

  <ul>
    <li>To get CCS and/or Energia up and running.</li>
    <li>To become familiar with the <em>User Guide</em> and datasheet (these will answer so many questions for you in the future).</li>
    <li>To learn to program an MSP430G2553 on the Launchpad.</li>
  </ul>

</div>

<div class="alert alert-danger" role="alert">
  <h4 id="what-should-be-turned-in"><strong>What should be turned in?</strong></h4>

  <ol>
    <li>Your <strong>commented</strong> morse-code.c file.</li>
  </ol>

</div>

<h4 id="due-date-monday-january-30-2022-at-330">Due Date: <strong>Monday, January 30, 2022 at 3:30</strong></h4>

<h4 id="part-0-installation-will-do-in-class">Part 0: Installation (will do in class!)</h4>

<p>You are welcome to install TI’s <a href="https://www.ti.com/tool/download/CCSTUDIO">Code Composer Studio (CCS)</a>
on your own personal computers.  The updated Launchpad you are using this semester appears to
be well supported in the Ubuntu version of CCS (as well as Windows). It is not yet known
whether the beta OSX version is also working well.</p>

<p><a href="http://energia.nu/"><strong>Energia</strong></a> is a clone of the Arduino environment for the MSP430. We will
not use the Java-based approach used by Arduino, but the compiling and device programming
components are still quite useful. Note that the Instructions for installing Energia can be
found at the project home page: <a href="http://energia.nu/">http://energia.nu/</a>. We will not
officially support Energia users in the class, however, we have found it to be quite usable in
a minimal sense. Specifically, by creating a new tab in a sketch with a “.c” extension, one can
write C-language code that is properly understood and compiled. You can then delete all the
stuff in the original sketch window (though it appears you have to leave the file there for
things to work). If you are going to use Energia, please make sure that you <strong>do not</strong> use the
Arduino-style sketch code but rather C-language or assembly.</p>

<p><a href="http://software-dl.ti.com/msp430/msp430_public_sw/mcu/msp430/MSPGCC/latest/index_FDS.html"><strong>msp430-gcc</strong></a>
is a fork of the gcc compiler which has tools to compile, assemble, disassemble, etc. MSP430
code. By itself, this can be a useful tool for understanding MSP430 code. With the addition of
the mspdebug package (available under Ubuntu Linux or Homebrew), code can also be uploaded to a
device.</p>

<h4 id="part-1-verify-ccsenergia-and-launchpad-functionality-and-examine-the-skeleton-code">Part 1: Verify CCS/Energia and Launchpad functionality and examine the skeleton code</h4>

<p>Compile the included
<a href="https://github.com/ckemere/ELEC327/blob/master/Labs/Lab1/delay_cycles_example.c">delay_cycles_example.c</a>
file to verify that CCS is setup correctly. (In Energia, you will need to create a new
“sketch”, add a tab with the name lab1.c or somesuch, erase the stuff in the first tab, and
then code away in the second “.c” one.) You should also read through this file: it shows the
minimum amount of code needed to run the MSP430 in an infinite loop. If you ever don’t know
what some variable acronym means, look it up! A useful practice is right clicking the name and
going to “Open Declaration” (instructions for CCS are in red). For instance, in this file,
doing this on <code class="language-plaintext highlighter-rouge">CALBC\_1MHZ</code> brings you to:</p>

<p><code class="language-plaintext highlighter-rouge">SFR\_8BIT(CALCBC1\_1MHZ)/\* BSCTL1 Calibration Data for 1 MHz \*/</code></p>

<p>And inspecting <code class="language-plaintext highlighter-rouge">BSTCTL1</code> shows:</p>

<p><code class="language-plaintext highlighter-rouge">SFR\_8BIT(BCSCTL1)/\* Basic Clock System Control \*/</code></p>

<p>What, then, is the “clock system control” that is being referred to? Two resources you should
use extensively are the <a href="/2023/assets/documents/slau144j_userguide.pdf">MSP430x2xx Family User Guide</a>
and the <a href="/2023/assets/documents/msp430g2553.pdf">MSP430G2553 datasheet</a>, both of which can be found
on the main 327 page (or by googling). The user guide explains how to use various functions or
registers common to most MSP430s, while the data sheet has register values and pin information
specific to the G2553. So, searching for “BCSCTL1” on the user guide takes you to Chapter 5 and
Chapter 24, from which you can figure out that this line will set the frequency of the DCO to a
calibrated 1 MHz.</p>

<p>On the web, you may notice a function called “__delay_cycles”. You will find that
documentation of this function is somewhat lacking on the internet. If you look in the <a href="/2023/assets/documents/slau132k.pdf">MSP430
Optimizing Compiler Guide</a>, you will see that it is not a C
function, but rather an “intrinsic”. In hindsight, if its role is to delay the processor a
precise number of cycles that can range from 1 to some large number, it could not be a function
(because calling a function takes more than one cycle!). A compiler intrinsic is something like
a macro - it is something that is replaced by appropriate code at compile time. In this case,
__delay_cycles is marked as deprecated, no doubt because its use leads to poor quality code
because it blocks the processor but still runs at full power. In this class, you should
generally not write code which calls this function.</p>

<h4 id="part-2-understanding-what-the-c-compiler-is-doing">Part 2: Understanding what the C compiler is doing</h4>
<p>The goal of the compilation process is to turn a program written in a high-level language into
machine code.</p>

<p><strong>Please read</strong> <a href="https://www.theunterminatedstring.com/the-greedy-c-runtime/">this very interesting
writeup</a> about what code is
generated by a C compiler when it is naively called and after code size optimization is done.
We will discuss the operations of the compiler/assembler in class.</p>

<p>For those of you interested in understanding how compiler-to-opcode conversion might have
interesting effects in the modern-day context,
<a href="https://www.blackhat.com/docs/us-17/thursday/us-17-Domas-Breaking-The-x86-ISA.pdf">this</a> is an
interesting presentation from the 2017 BlackHat conference.</p>

<h4 id="part-3-blinking-a-morse-code-message">Part 3: Blinking a Morse Code Message</h4>

<p>Using the P1.0 LED on your launchpad, blink a message in Morse code. Look Morse code up on
Wikipedia to find the code for each letter and how to separate letters. Submit your code in a
separate file named <code class="language-plaintext highlighter-rouge">morse-code.c</code>. <strong>Every line should have a meaningful comment and extra
comments are welcome!</strong> Two example skeletons are given in:
<a href="https://github.com/ckemere/ELEC327/blob/master/Labs/Lab1/lab1_skeleton.c">lab1_skeleton.c</a>
and
<a href="https://github.com/ckemere/ELEC327/blob/master/Labs/Lab1/lab1_skeleton_ver2.c">lab1_skeleton_ver2.c</a></p>

<p>A few specifications:</p>

<ul>
  <li>A “unit” should be ¼ of a second.</li>
  <li>Use whatever clock and Timer mode you want, <strong>but make sure that you are using an interrupt
to control the timing of the program.</strong></li>
  <li>Organize your code such that to change the message, you only have to change one array at the
beginning of your program (this should be an array of Morse code “dots” and “dashes”).</li>
  <li>Be able to display either “SOS” or 3 other letters (i.e., your initials, the first 3 letters
of your first name, etc), depending on which array is commented out.</li>
  <li>Your message should repeat.</li>
  <li>Consider repetitions of your message different words. This means that you should have 7
“units” of off time between each repetition. If you want, this as well as spaces between
letters and parts of the same letter can be hard coded into your array.</li>
  <li>To help yourself write clean code, you should use “BITx” whenever you do anything with a pin
on the MSP430.</li>
  <li>You should use one of the timer interrupts for timing. Function LED flashing code is given in
an example from the MSP-example code archive in the “Labs/Lab1/” directory of the <a href="https://github.com/ckemere/ELEC327">course
repository</a>.</li>
  <li><strong>Bonus 1:</strong> For those of you feeling under-tasked by this lab, extra
credit will be given for an implementation of code that uses a second timer interrupt to
change the color of the RGB LED on the launchpad asynchronously with the Morse code message.
See Bonus page for more details.</li>
  <li><strong>Continuing Bonus 1:</strong> For those of you feeling particularly under-tasked by this lab, extra
credit will be given for a second implementation of code that reads in the LED flashes and
decodes the Morse code message. See Bonus page for more details.</li>
</ul>

<!---
#### Part 3: Moving it to a Breadboard (Don't do in 2021!!!!)

We'll be working with a lot of input/output devices in this class, and so it makes sense to be
able to program an MSP430 on a breadboard so that it can run independently. Make this
breadboard wiring clean, as you'll be testing a lot of circuits using it. To actually program
the MSP430 on a breadboard using the launchpad, you only need to:

1. Connect the TEST and RST pins on the EMULATION side of the launchpad to their respective
   pins on the MSP430 (these are labeled on the launchpad where the MSP430 itself is usually
   located).  
2. Connect Vcc and GND (or some independent battery, but for now use the launchpad's power) to
   their respective pins. For your convenience, jump these to the power lines on the
   breadboard. To ensure a clean power supply to the MSP430, connect a 10uF capacitor anywhere on
   the board between Vcc and GND.
3. Connect a pull-up resistor to the RST pin, as it is active-low. That is, connect a large
   resistor (47K from lab is fine) from the RST pin to Vcc, to ensure that its default state is
   high.

Now, reproduce your Morse code circuit on the breadboard using LEDs and resistors in the lab.
There are, however, some differences you need to take into account – **see questions below!**
Wire the circuit on your breadboard, and successfully program it.
--->

<h4 id="demoing-code">Demoing code</h4>

<p>Over the course of the semester we will be developing a good schedule for demos. You will be
required to demonstrate your code to one of the course staff. You should be prepared to show
your code running on a breadboard, as well as changing the Morse code message, reprogramming,
and showing the subsequent functioning.</p>

<h4 id="questions-not-gradedfor-reference">Questions (<strong>not graded/for reference</strong>):</h4>

<p>Please reference your answers to one of the authoritative sources.</p>

<p><em>Questions from the skeleton code:</em></p>

<ol class="questions" start="1">
<li>In the Part 1 delay cycles example code, what is the frequency and period of the LED?
(Hint! You can assume that delay cycles is exact, but how many cycles does
the next line take?)</li>
</ol>

<p><em>Questions about the lab:</em></p>

<ol class="questions" start="2">
<li>In a later lab, we will use these LEDs:
[https://www.digikey.com/en/products/detail/everlight-electronics-co-ltd/17-215SYGC-S530-E2-TR8/2691488](https://www.digikey.com/en/products/detail/everlight-electronics-co-ltd/17-215SYGC-S530-E2-TR8/2691488).
What is the typical forward voltage across the LED at 1 mA drive current (you'll have to squint at
the figure in the datasheet!)? What is its maximum forward current?</li>
<li>If the supply voltage of the MSP430 is 3.3 V, what voltage is sourced for an output pin that is
logically high? On the MSP430G2553, what is the maximum current any one pin can output?</li>
<li>If you want to be safe and provide a 1 mA current to your LED, what is the resistor value you
should use in series with the LED? If you wanted the LED to be brighter, should you use a larger or
smaller resistor?</li> </ol>

<p><strong>Upload your code to Canvas. You will demo functionality in class on Monday.</strong></p>



      <hr>
      <footer>
        <p>
        &copy; 2024 <a href="http://kemerelab.com">Caleb Kemere</a>
        and <a href="http://www.ece.rice.edu">Rice University ECE</a>
        </p>
      </footer>
    </div>

    

    <script src="/assets/themes/bootstrap/resources/jquery/jquery.min.js"></script>
    <script src="/assets/themes/bootstrap/resources/bootstrap/js/bootstrap.min.js"></script>
  </body>
</html>


